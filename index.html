<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Xemble Explanation Questionnaire</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/3.3.4/vue.global.min.js"></script>
  <style>
    * {
      box-sizing: border-box;
      font-family: Arial, sans-serif;
    }
    body {
      margin: 0;
      padding: 20px;
      background: #f5f5f5;
    }
    .container {
      max-width: 800px;
      margin: 0 auto;
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .section {
      margin-bottom: 30px;
    }
    h2 {
      margin-top: 0;
    }
    .options, .likert-scale {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    .option, .likert-option {
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 4px;
      cursor: pointer;
    }
    .option.selected, .likert-option.selected {
      background: #e3f2fd;
      border-color: #2196F3;
    }
    .buttons {
      display: flex;
      justify-content: space-between;
      margin-top: 20px;
    }
    button {
      padding: 10px 20px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 15px;
    }
    table, th, td {
      border: 1px solid #ddd;
    }
    th, td {
      padding: 8px;
      text-align: center;
    }
    .small-text {
      font-size: 0.9em;
      color: #555;
    }
    .training-feedback, .status {
      margin-top: 10px;
      padding: 10px;
      border-radius: 4px;
    }
    .training-feedback {
      background-color: #e8f5e9;
      color: #2e7d32;
    }
    .phase-header {
      margin-bottom: 15px;
      font-style: italic;
      color: #333;
    }
    .comparative-method {
      border: 1px solid #ddd;
      border-radius: 4px;
      padding: 10px;
      margin-bottom: 15px;
    }
    .comparative-method h4 {
      margin: 0 0 10px;
    }
    /* Update Likert scale styles */
    .likert-scale {
      display: flex;
      flex-direction: row; /* added for horizontal layout */
      justify-content: space-between;
      margin: 20px 0;
      text-align: center;
    }
    .likert-option {
      flex: 1;
      padding: 10px;
      cursor: pointer;
      border: 1px solid #ddd;
      margin: 0 5px;
      border-radius: 4px;
    }
    .likert-option.selected {
      background: #e3f2fd;
      border-color: #2196F3;
    }
    .likert-label {
      font-size: 0.8em;
      margin-top: 5px;
    }
    .explanation {
      font-style: italic;
      margin-top: 10px;
      color: #555;
    }
    .current-question {
      font-style: italic;
      margin-top: 10px;
      color: #555;
    }

  </style>
</head>
<body>
  <div id="app" class="container">
    <!-- Consent Screen -->
    <div v-if="!consentGiven" class="section">
      <h2>Survey Description</h2>
      <p>
        This survey aims to gather information about your preferences and experiences in software development and your evaluation of AI explanations. Your responses will be used for research purposes only.
      </p>
      <h3>Consent</h3>
      <p>
        By proceeding with this survey, you consent to participate in this research study. Your participation is voluntary and you may withdraw at any time.
      </p>
      <button @click="giveConsent()">I Consent</button>
    </div>

    <!-- Training Screen -->
    <div v-else-if="consentGiven && !trainingCompleted" class="section">
      <h2>Training Section</h2>
      <!-- (Optional sample block can be added here as well if needed) -->
      <div class="section">
        <h3>{{ trainingQuestion.text }}</h3>
        <p class="explanation">Explanation: {{ trainingQuestion.explanation }}</p>
        <div class="small-text">Click on one of the options below:</div>
        <div class="options">
          <div
            v-for="option in trainingQuestion.options"
            :key="option"
            class="option"
            :class="{ selected: trainingAnswer === option }"
            @click="selectTrainingAnswer(option)"
          >
            {{ option }}
          </div>
        </div>
        <div v-if="trainingAnswer" class="training-feedback">
          {{ trainingQuestion.explanation }}
        </div>
      </div>
      <button @click="completeTraining()" :disabled="!trainingAnswer">Proceed to Survey</button>
    </div>

    <!-- Survey Questions -->
    <div v-else-if="surveyStarted && !surveyCompleted" class="section">
      <h2>Survey Questions</h2>
      <div v-if="currentSurveyQuestion">
        <!-- Sample Information Block -->
        <div v-if="currentCase">
          <h3>
            Dataset: {{ currentCase.dataset }} | Sample ID: {{ currentCase.id }}
          </h3>
          <p><strong>Feature Values:</strong></p>
          <table>
            <thead>
              <tr>
                <th>Feature</th>
                <th>Value</th>
              </tr>
            </thead>
            <tbody>
              <tr v-for="(value, key) in currentCase.features" :key="key">
                <td>{{ key }}</td>
                <td>{{ value }}</td>
              </tr>
            </tbody>
          </table>
          <p>
            <strong>Explanation ({{ currentMethod }}):</strong>
            {{ currentCase.explanations[currentMethod] }}
          </p>
        </div>

        <!-- Display Question Text and Options -->
        <p><strong> {{ currentSurveyQuestion.text }}</strong></p>

        <!-- Likert Scale Questions -->
        <div v-if="currentSurveyQuestion.type==='likert'" class="likert-scale">
          <div
            v-for="num in 9"
            :key="num"
            class="likert-option"
            :class="{ selected: answers[currentSurveyQuestion.id] === num }"
            @click="answerSurvey(num)"
          >
            <div>{{ num }}</div>
          </div>
        </div>

        <!-- Multiple Choice Questions -->
        <div v-else-if="currentSurveyQuestion.type==='multiple'" class="options">
          <div
            v-for="option in currentSurveyQuestion.options"
            :key="option"
            class="option"
            :class="{ selected: answers[currentSurveyQuestion.id] === option }"
            @click="answerSurvey(option)"
          >
            {{ option }}
          </div>
        </div>

        <!-- Open-ended Questions -->
        <div v-else-if="currentSurveyQuestion.type==='textarea'">
          <textarea v-model="answers[currentSurveyQuestion.id]" placeholder="Enter your answer here..." style="width: 100%; min-height: 80px; padding: 8px; border: 1px solid #ddd; border-radius: 4px;"></textarea>
        </div>
      </div>

      <div class="buttons">
        <button @click="prevSurveyQuestion" :disabled="currentSurveyIndex === 0">Previous</button>
        <button v-if="!isLastSurveyQuestion" @click="nextSurveyQuestion" :disabled="answers[currentSurveyQuestion.id] === undefined || answers[currentSurveyQuestion.id] === ''" style="margin-left: auto;">Next</button>
        <button v-else @click="submitSurvey" :disabled="answers[currentSurveyQuestion.id] === undefined || answers[currentSurveyQuestion.id] === ''" style="margin-left: auto;">Submit Survey</button>
      </div>
      <div class="current-question">
        Question {{ currentSurveyIndex + 1 }} of {{ surveyQuestions.length }}
      </div>
    </div>

    <!-- Completion Screen -->
    <div v-else class="section">
      <h2>Thank you for completing the survey!</h2>
      <div class="status" v-for="(msg, i) in submissionStatus" :key="i">
        {{ msg }}
      </div>
    </div>
  </div>

  <script>
    Vue.createApp({
      data() {
        return {
          // Consent and Training
          consentGiven: false,
          trainingCompleted: false,
          trainingQuestion: {
            text: "How would you rate your familiarity with AI explanations?",
            options: ["Not familiar", "Somewhat familiar", "Very familiar"],
            explanation: "" // will be set once randomly
          },
          trainingAnswer: null,
          
          // Survey Questions logic
          surveyStarted: false,
          surveyCompleted: false,
          surveyQuestions: [
            // 1. Clarity
            {
              id: "clarity_rating",
              text: "On a scale from 1 (Not clear at all) to 9 (Extremely clear), how clearly did the explanation communicate how the ensemble reached its decision?",
              type: "likert"
            },
            {
              id: "clarity_open",
              text: "What aspects of the explanation were unclear or confusing?",
              type: "textarea"
            },
            // 2. Trustworthiness
            {
              id: "trust_rating",
              text: "On a scale from 1 (Do not trust at all) to 9 (Fully trust), to what extent do you trust the explanation provided?",
              type: "likert"
            },
            {
              id: "trust_open",
              text: "Did any part of the explanation increase or decrease your trust in the ensemble’s decision? If so, which part and why?",
              type: "textarea"
            },
            // 3. Comprehensibility
            {
              id: "comprehensibility_rating",
              text: "On a scale from 1 (Very difficult) to 9 (Very easy), how easy was it to understand the explanation?",
              type: "likert"
            },
            {
              id: "comprehensibility_detail",
              text: "Did the explanation contain too much technical detail, too little, or was it balanced?",
              type: "multiple",
              options: ["Too much", "Too little", "Balanced"]
            },
            // 4. Satisfaction
            {
              id: "satisfaction_rating",
              text: "On a scale from 1 (Not satisfied at all) to 9 (Extremely satisfied), how satisfied are you with the explanation provided?",
              type: "likert"
            },
            {
              id: "satisfaction_open",
              text: "What could improve the explanation to better meet your needs?",
              type: "textarea"
            },
            // 5. Usefulness
            {
              id: "Usefulness_rating",
              text: "On a scale from 1 (Not useful at all) to 9 (Extremely useful), how useful was the explanation for understanding the ensemble's decision?",
              type: "likert"
            },
            {
              id: "Usefulness_open",
              text: "How would you describe the usefulness of the explanation in a real-world decision-making scenario?",
              type: "textarea"
            },
            // 6. Accuracy Perception
            {
              id: "accuracy_rating",
              text: "On a scale from 1 (Very inaccurate) to 9 (Highly accurate), how accurate do you believe the ensemble's prediction was based on the explanation?",
              type: "likert"
            },
            {
              id: "accuracy_justification_rating",
              text: "If the prediction was incorrect, how well did the explanation justify the error? (1 = Not at all, 9 = Fully justified)",
              type: "likert"
            },
            // 7. Confidence in the Prediction
            {
              id: "confidence_rating",
              text: "On a scale from 1 (Not confident at all) to 9 (Extremely confident), how confident are you in acting upon this prediction?",
              type: "likert"
            },
            {
              id: "confidence_info",
              text: "What additional information would increase your confidence in the ensemble’s output?",
              type: "textarea"
            },
            // 8. Transparency
            {
              id: "transparency_rating",
              text: "On a scale from 1 (Not transparent at all) to 9 (Extremely transparent), how transparent did you find the ensemble’s decision-making process?",
              type: "likert"
            },
            {
              id: "transparency_yesno",
              text: "Did the explanation clarify how different base learners contributed to the final decision?",
              type: "multiple",
              options: ["Yes", "No"]
            },
            // 9. Consistency
            {
              id: "consistency_rating",
              text: "On a scale from 1 (Not consistent at all) to 9 (Highly consistent), how consistent was the explanation with what you expected from the ensemble’s decision?",
              type: "likert"
            },
            {
              id: "consistency_yes_no",
              text: "If you were shown multiple decisions, do you feel the explanations were consistent across cases?",
              type: "multiple",
              options: ["Yes", "No"]
            },
            // 10. Relevance of Justifications
            {
              id: "relevance_rating",
              text: "On a scale from 1 (Not relevant at all) to 9 (Highly relevant), how relevant were the justifications provided for the ensemble’s decision?",
              type: "likert"
            },
            {
              id: "relevance_open",
              text: "Were there any justifications that seemed unnecessary or missing?",
              type: "textarea"
            }
          ],
          currentSurveyIndex: 0,
          answers: {},
          submissionStatus: [],
          
          // Dataset properties
          datasets: [],
          currentCase: null,
          // Explanation method selected only once (e.g., "Xemble" or "SHAP")
          currentMethod: "",
          
          // Legacy explanation mapping (still shown with question explanation text)
          surveyExplanations: {}
        }
      },
      computed: {
        currentSurveyQuestion() {
          return this.surveyQuestions[this.currentSurveyIndex];
        },
        isLastSurveyQuestion() {
          return this.currentSurveyIndex === this.surveyQuestions.length - 1;
        }
      },
      methods: {
        giveConsent() {
          this.consentGiven = true;
        },
        selectTrainingAnswer(option) {
          this.trainingAnswer = option;
        },
        completeTraining() {
          this.trainingCompleted = true;
          // Start the survey questions after training is complete.
          this.surveyStarted = true;
        },
        nextSurveyQuestion() {
          if (this.currentSurveyIndex < this.surveyQuestions.length - 1) {
            this.currentSurveyIndex++;
          }
        },
        prevSurveyQuestion() {
          if (this.currentSurveyIndex > 0) {
            this.currentSurveyIndex--;
          }
        },
        answerSurvey(answer) {
          this.answers[this.currentSurveyQuestion.id] = answer;
        },
        submitSurvey() {
          console.log("Survey answers:", this.answers);
          this.submissionStatus.push("Survey submitted successfully.");
          this.surveyCompleted = true;
        },
        // Fetch dataset and select one random dataset sample
        fetchDatasets() {
          fetch('https://raw.githubusercontent.com/ronbenshimol/xemble-prolific/refs/heads/main/data.json')
            .then(response => response.json())
            .then(data => {
              this.datasets = data.datasets;
              if (this.datasets.length) {
                let randomDataset = this.datasets[Math.floor(Math.random() * this.datasets.length)];
                if (randomDataset.samples && randomDataset.samples.length) {
                  let randomSample = randomDataset.samples[Math.floor(Math.random() * randomDataset.samples.length)];
                  this.currentCase = randomSample;
                  this.currentCase.dataset = randomDataset.name;
                }
              }
            })
            .catch(error => console.error("Failed to load data.json:", error));
        }
      },
      created() {
        this.fetchDatasets();
        // Randomly select one explanation method for all questions and sample display
        this.currentMethod = Math.random() < 0.5 ? 'Xemble' : 'SHAP';
        // Legacy: assign the chosen method to all survey questions for the in-question explanation text
        this.surveyQuestions.forEach(q => {
          this.surveyExplanations[q.id] = this.currentMethod;
        });
        // Also assign the chosen method for the training question
        this.trainingQuestion.explanation = this.currentMethod;
      }
    }).mount('#app');
  </script>
</body>
</html>
